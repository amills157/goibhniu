FROM alpine:3.16.0

RUN apk update

RUN apk add rsyslog nano sudo openssl

RUN sed -i '/imklog/s/^/#/' /etc/rsyslog.conf

COPY Configs/rsyslog.conf /etc/rsyslog.conf

COPY Scripts/alpine_rsyslogd_to_stdout.sh /bin/entrypoint

RUN chmod +x /bin/entrypoint

RUN echo "root:root" | chpasswd

RUN addgroup -S alpinegroup && adduser -S alpine -G alpinegroup

RUN echo "alpine ALL=(ALL) ALL" > /etc/sudoers.d/alpine

RUN chmod 0440 /etc/sudoers.d/alpine

RUN echo "alpine:alpine" | chpasswd alpine

RUN chmod u+s $(which rsyslogd)

RUN touch /var/log/messages

RUN chown root:adm /var/log/messages

RUN chmod a+r /var/log/messages

USER alpine

WORKDIR /home/alpine

CMD ["entrypoint"]